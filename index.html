<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ContentScore - TikTok Analyzer</title>
    <style>
        /* ---------- Styles ---------- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
               background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
               min-height: 100vh; display: flex; justify-content: center; align-items: center; }
        .phone { width: 375px; height: 812px; background: #000; border-radius: 40px; padding: 8px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); }
        .screen { width: 100%; height: 100%; background: #fff; border-radius: 32px; overflow: hidden; position: relative; }
        .app-header { background: linear-gradient(135deg, #ff6b6b, #feca57); padding: 50px 20px 30px 20px; text-align: center; color: white; }
        .app-title { font-size: 24px; font-weight: 700; margin-bottom: 5px; }
        .app-subtitle { font-size: 14px; opacity: 0.9; }
        .content { padding: 20px; height: calc(100% - 150px); overflow-y: auto; }
        .upload-section { text-align: center; margin-bottom: 30px; }
        .upload-btn { width: 100%; height: 120px; border: 3px dashed #ddd; border-radius: 12px; background: #f8f9fa; display: flex; flex-direction: column; justify-content: center; align-items: center; cursor: pointer; transition: all 0.3s ease; margin-bottom: 15px; }
        .upload-btn:hover { border-color: #ff6b6b; background: #fff5f5; }
        .upload-icon { font-size: 40px; margin-bottom: 10px; }
        .analyze-btn { width: 100%; padding: 15px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; transition: transform 0.2s ease; }
        .analyze-btn:hover { transform: translateY(-2px); }
        .results-section { display: none; }
        .results-section.active { display: block; }
        .overall-score { text-align: center; background: linear-gradient(135deg, #ffeaa7, #fdcb6e); padding: 25px; border-radius: 20px; margin-bottom: 25px; box-shadow: 0 10px 30px rgba(253, 203, 110, 0.3); }
        .score-value { font-size: 48px; font-weight: 700; color: #2d3436; margin-bottom: 5px; }
        .score-tier { font-size: 18px; font-weight: 600; color: #636e72; }
        .metrics-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 25px; }
        .metric-card { background: #fff; padding: 20px; border-radius: 16px; box-shadow: 0 5px 15px rgba(0,0,0,0.08); text-align: center; }
        .metric-name { font-size: 12px; color: #636e72; margin-bottom: 8px; text-transform: uppercase; font-weight: 600; }
        .metric-value { font-size: 24px; font-weight: 700; color: #2d3436; }
        .metric-good { color: #00b894; }
        .metric-average { color: #fdcb6e; }
        .metric-poor { color: #e17055; }
        .recommendations { background: #f8f9fa; padding: 20px; border-radius: 16px; margin-bottom: 25px; }
        .recommendations h3 { color: #2d3436; font-size: 16px; margin-bottom: 15px; display: flex; align-items: center; }
        .recommendation-item { background: white; padding: 15px; margin-bottom: 10px; border-radius: 12px; font-size: 14px; color: #636e72; border-left: 4px solid #00b894; }
        .earnings-section { background: linear-gradient(135deg, #a8e6cf, #7fcdcd); padding: 20px; border-radius: 16px; color: white; text-align: center; }
        .earnings-title { font-size: 16px; margin-bottom: 15px; opacity: 0.9; }
        .earnings-amount { font-size: 32px; font-weight: 700; margin-bottom: 10px; }
        .earnings-breakdown { font-size: 12px; opacity: 0.8; }
        .loading { display: none; text-align: center; padding: 40px; }
        .loading.active { display: block; }
        .spinner { width: 50px; height: 50px; border: 4px solid #f3f3f3; border-top: 4px solid #667eea; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div class="phone">
        <div class="screen">
            <div class="app-header">
                <div class="app-title">ContentScore</div>
                <div class="app-subtitle">AI-Powered Content Analysis</div>
            </div>

            <div class="content">
                <!-- Upload Section -->
                <div class="upload-section" id="uploadSection">
                    <div class="upload-btn" onclick="selectVideo()">
                        <div class="upload-icon">ðŸŽ¥</div>
                        <div>Tap to Upload Video</div>
                        <div style="font-size: 12px; color: #999; margin-top: 5px;">MP4, MOV, AVI supported</div>
                    </div>
                    <input type="file" id="videoInput" accept="video/*" style="display: none;">
                    <button class="analyze-btn" onclick="analyzeContent()" id="analyzeBtn" disabled>
                        Select Video First
                    </button>
                </div>

                <!-- Loading Section -->
                <div class="loading" id="loadingSection">
                    <div class="spinner"></div>
                    <h3>Analyzing Your Content...</h3>
                    <p style="color: #666; margin-top: 10px;">This usually takes 10-30 seconds</p>
                    <div style="margin-top: 20px; font-size: 14px; color: #888;">
                        <div>ðŸ¤– Running AI analysis...</div>
                        <div style="margin-top: 5px;">ðŸŽ¯ Calculating metrics...</div>
                        <div style="margin-top: 5px;">ðŸ’¡ Generating recommendations...</div>
                    </div>
                </div>

                <!-- Results Section -->
                <div class="results-section" id="resultsSection">
                    <div class="overall-score">
                        <div class="score-value">0.00</div>
                        <div class="score-tier">ðŸ¥ˆ Tier</div>
                    </div>
                    <div class="metrics-grid" id="metricsGrid"></div>
                    <div class="recommendations" id="recommendations"></div>
                    <div class="earnings-section">
                        <div class="earnings-title">ðŸ’° Estimated Earnings</div>
                        <div class="earnings-amount">0 Credits</div>
                        <div class="earnings-breakdown"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let videoSelected = false;

        function selectVideo() {
            document.getElementById('videoInput').click();
        }

        document.getElementById('videoInput').addEventListener('change', function(e) {
            if (e.target.files.length > 0) {
                videoSelected = true;
                const analyzeBtn = document.getElementById('analyzeBtn');
                analyzeBtn.textContent = 'Analyze Content';
                analyzeBtn.disabled = false;
                analyzeBtn.style.background = 'linear-gradient(135deg, #667eea, #764ba2)';

                const uploadBtn = document.querySelector('.upload-btn');
                uploadBtn.innerHTML = `
                    <div class="upload-icon">âœ…</div>
                    <div>Video Selected</div>
                    <div style="font-size: 12px; color: #666; margin-top: 5px;">${e.target.files[0].name}</div>
                `;
                uploadBtn.style.borderColor = '#00b894';
                uploadBtn.style.background = '#f0fff4';
            }
        });

        async function analyzeContent() {
            if (!videoSelected) return;

            document.getElementById('uploadSection').style.display = 'none';
            document.getElementById('loadingSection').classList.add('active');

            const videoInput = document.getElementById('videoInput');
            const formData = new FormData();
            formData.append('video', videoInput.files[0]);

            try {
                const response = await fetch('/analyze-video', {  // Relative path works with Flask
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                document.getElementById('loadingSection').classList.remove('active');
                document.getElementById('resultsSection').classList.add('active');

                // Overall
                const overall = data.scores.overall ?? 0;
                document.querySelector('.score-value').textContent = overall.toFixed(2);
                document.querySelector('.score-tier').textContent = `ðŸ¥ˆ ${data.tier ?? "Tier"}`;

                // Metrics
                const metricsGrid = document.getElementById('metricsGrid');
                metricsGrid.innerHTML = '';
                for (const [metric, value] of Object.entries(data.scores)) {
                    if (metric === 'overall') continue;
                    const card = document.createElement('div');
                    card.className = 'metric-card';
                    card.innerHTML = `
                        <div class="metric-name">${metric}</div>
                        <div class="metric-value ${value>=0.75?'metric-good':value>=0.5?'metric-average':'metric-poor'}">
                            ${value.toFixed(2)}
                        </div>
                    `;
                    metricsGrid.appendChild(card);
                }

                // Recommendations
                const recContainer = document.getElementById('recommendations');
                recContainer.innerHTML = '<h3>ðŸ’¡ AI Recommendations</h3>';
                (data.recommendations || []).forEach(rec => {
                    const div = document.createElement('div');
                    div.className = 'recommendation-item';
                    div.textContent = rec;
                    recContainer.appendChild(div);
                });

                // Earnings
                document.querySelector('.earnings-amount').textContent = `${data.earnings.amount ?? 0} Credits`;
                document.querySelector('.earnings-breakdown').textContent = data.earnings.breakdown ?? '';

            } catch (err) {
                alert("Error analyzing video: " + err);
                document.getElementById('uploadSection').style.display = 'block';
                document.getElementById('loadingSection').classList.remove('active');
            }
        }
    </script>
</body>
</html>